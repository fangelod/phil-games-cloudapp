var Problem=function(e,a){this.catRight=!0,this.markRight=!0,this.user=a,this.categories=[];for(var n=0;n<e.categories.length;n++)this.categories.push(e.categories[n].plural);this.currCategory=0,this.selectedCategories=[],this.premises=e.premises,this.venns=[],this.createVenns(this.premises),this.statements=[],this.vennDiagram=new Venn(5,5,80,this.categories),this.createStatements(),this.currPremise=0,this.conclusion=e.conclusion,this.replaced=!0;var t=this;$("#vennCheckButton").click(this.checkVenn.bind(this)),$("#catCheckButton").show(),$("#validButton").click(t.checkValid.bind(t)),$("#invalidButton").click(t.checkInvalid.bind(t)),$("#catCheckButton").click(this.checkCategories.bind(this)),$("#vennRevertButton").click(this.revertVenn.bind(t)),$("#newProblemButton").click(function(){$("#difficultyModal").modal(),t.replaced=!1}),$("#easyButton").click(function(){t.replaced||(t.replace("easy"),t.replaced=!0)}),$("#mediumButton").click(function(){t.replaced||(t.replace("medium"),t.replaced=!0)}),$("#hardButton").click(function(){t.replaced||(t.replace("hard"),t.replaced=!0)}),$(document).on("keydown",function(e){var a=e.which||e.keyCode;13===a&&t.submit()})};Problem.prototype.replace=function(e){$(".statements").html(""),$("#conclusion").html(""),$(".alert").hide(),$(".check").each(function(){$(this).replaceWith($(this).clone())}),$("#venn-container > .instructions").hide(),$("#newProblemButton").hide(),$(document).off(),$("#conclusion-container").hide();var a=$('<canvas id="c" height = "300px" width = "500px"></canvas>');$("canvas").replaceWith(a),canvas=a.get(0),ctx=canvas.getContext("2d"),this.user.getProblem(e)},Problem.prototype.checkInvalid=function(){var e=!this.evaluateConclusion();$("#newProblemButton").show(),$("#conclusion-buttons").hide(),$("#conclusion-right").hide(),$("#conclusion-wrong").hide(),e?($("#conclusion-right").show(),this.user.validRight()):($("#conclusion-wrong").show(),this.user.validWrong())},Problem.prototype.checkValid=function(){var e=this.evaluateConclusion();$("#conclusion-buttons").hide(),$("#conclusion-right").hide(),$("#conclusion-wrong").hide(),$("#newProblemButton").show(),e?($("#conclusion-right").show(),this.user.validRight()):($("#conclusion-wrong").show(),this.user.validWrong())},Problem.prototype.submit=function(){this.selectedCategories.length>=3?this.checkVenn():this.checkCategories()},Problem.prototype.checkCategory=function(e){for(var a=!0,n=!0,t=0;t<this.statements.length;t++){var i=this.statements[t].isHighlightedCorrectly(e);1==i&&(n=!1),0==i&&(a=!1)}return a?2:n?0:1},Problem.prototype.checkCategories=function(){if(!(this.selectedCategories.length>=3)){for(var e=!1,a=!1,n=-1,t=[],i=0;i<this.statements.length;i++)if(this.statements[i].highlightedNonCategory(this.categories)){e=!0;break}if(!e){for(var i=0;i<this.categories.length;i++)t.push(this.checkCategory(this.categories[i]));for(var i=0;i<t.length;i++){for(var s=0;s<t.length;s++)if(0!==t[i]&&i!==s&&0!==t[s]){e=!0;break}if(e)break;if(2==t[i]){this.selectedCategories.indexOf(this.categories[i])>-1?e=!0:(a=!0,n=i,this.selectedCategories.push(this.categories[i]));break}}}var r=this.selectedCategories.length;if(e)$("#statements-wrong").show(),$("#statements-missed").hide(),this.catRight=!1,this.user.catWrong();else if(a){for(var i=0;i<this.statements.length;i++)r>=3?this.statements[i].deactivate():this.statements[i].incrCategory();var h=this.selectedCategories[r-1],d=this.categories.indexOf(h)+1;this.vennDiagram.drawCircle(d),$(".alert").hide(),r>=3&&this.startVenn()}else $("#statements-wrong").hide(),$("#statements-missed").show()}},Problem.prototype.startVenn=function(){this.catRight&&this.user.catRight(),this.vennDiagram.activate(),$("#statements-right").show(),this.statements[this.currPremise].addArrow(),$("#venn-container > .instructions").show(),$("#vennCheckButton").show(),$("#vennRevertButton").show(),$("#catCheckButton").hide()},Problem.prototype.revertVenn=function(){this.vennDiagram.revertMarkup(),this.vennDiagram.colorVenn()},Problem.prototype.checkVenn=function(){for(var e=!0,a=this.venns[this.currPremise][0],n=this.venns[this.currPremise][1],t=0;t<a.length;t++)if(this.vennDiagram.shaded[t]!=a[t]){e=!1;break}for(var t=0;t<n.length;t++)for(var i=0;i<n.length;i++){if(n[i]==n[t]&&this.vennDiagram.marked[i]!=this.vennDiagram.marked[t]){e=!1;break}if(this.vennDiagram.marked[i]==this.vennDiagram.marked[t]&&n[i]!=n[t]){e=!1;break}}e?($("#vennRevertButton").html("Revert"),$("#venn-wrong").hide(),this.vennDiagram.saveMarkup(),this.statements[this.currPremise].removeArrow(),this.currPremise++,this.currPremise>=this.statements.length?(this.markRight&&this.user.markRight(),$("#venn-right").show(),$("#vennCheckButton").hide(),$("#vennRevertButton").hide(),this.vennDiagram.deactivate(),this.showConclusion()):this.statements[this.currPremise].addArrow()):($("#venn-wrong").show(),this.markRight=!1,this.user.markWrong())},Problem.prototype.replaceCategories=function(e){var a=e;return a=a.replace("1",this.categories[0]),a=a.replace("2",this.categories[1]),a=a.replace("3",this.categories[2])},Problem.prototype.showConclusion=function(){$("#conclusion-container").show(),$("#conclusion-buttons").show();var e=this.replaceCategories(this.conclusion),a=e.split(" ");"not"==a[1]&&(a.splice(1,1),a[1]="non-"+a[1]),e=a.join(" "),$("#conclusion").append(e)},Problem.prototype.createStatements=function(){for(var e=0;e<this.premises.length;e++){var a=this.replaceCategories(this.premises[e]),n=a.split(" ");"not"==n[1]&&(n.splice(1,1),n[1]="non-"+n[1]);var t=n.join(" ");this.statements.push(new Statement(t))}},Problem.prototype.spit=function(){for(var e=0;e<this.venns.length;e++)alert(this.venns[e][0]),alert(this.venns[e][1]);alert(this.vennDiagram.shaded),alert(this.vennDiagram.marked)},Problem.prototype.checkSelected=function(e,a,n){var t=e[a];if(null==n){if(0>=t)return!1;for(var i=0;i<e.length;i++)if(i!=a&&e[i]==t)return!1}else{var s=e[n];if(t==s){if(0==t)return!1;for(var i=0;i<e.length;i++)if(i!=a&&i!=n&&e[i]==t)return!1}else if(0==t){for(var i=0;i<e.length;i++)if(i!=n&&e[i]==s)return!1}else if(0==s){for(var i=0;i<e.length;i++)if(i!=a&&e[i]==t)return!1}else{for(var r=!0,i=0;i<e.length;i++)i!=a&&e[i]==t&&(r=!1);for(var i=0;i<e.length;i++)if(i!=n&&e[i]==s)return r}}return!0},Problem.prototype.maxValue=function(e){for(var a=0,n=0;n<e.length;n++)a=Math.max(e[n],a);return a},Problem.prototype.evaluateConclusion=function(){var e=this.conclusion.split(" "),a=e[0];e.splice(0,1);var n=e[0],t=!1,i=null,s=null,r=null,h=!1,d=!1,c=!1;if("not"==n&&(n=e[1],t=!0,e.splice(0,1)),e.splice(0,1),"and"==e[0]&&(i="and"),"exist"==e[0])h=!0;else{e.splice(0,1);var s=e[0];"not"==s&&(s=e[1],d=!0,e.splice(0,1)),e.splice(0,1),e.length>0&&("exist"==e[0]?h=!0:(null==i&&(i=e[0]),r=e[1],"not"==r&&(r=e[2],c=!0)))}var o,l,m,v,g,u,D;switch(D=6,1==n?(o=0,g=5,2==s?(l=1,v=3,m=2,u=4):(l=2,m=1,v=4,u=3)):2==n?(o=1,g=4,1==s?(l=0,v=3,m=2,u=5):(l=2,m=0,v=5,u=3)):3==n&&(o=2,g=3,2==s?(l=1,v=5,m=0,u=4):(l=0,m=1,v=4,u=5)),a){case"all":if(null==r)return t?d?1==this.vennDiagram.shaded[l]&&1==this.vennDiagram.shaded[g]:1==this.vennDiagram.shaded[m]:d?1==this.vennDiagram.shaded[v]&&1==this.vennDiagram.shaded[D]:1==this.vennDiagram.shaded[o]&&1==this.vennDiagram.shaded[u];switch(i){case"and":return t?d?c?1==this.vennDiagram.shaded[l]&&1==this.vennDiagram.shaded[m]&&1==this.vennDiagram.shaded[g]:1==this.vennDiagram.shaded[l]&&1==this.vennDiagram.shaded[g]:c?1==this.vennDiagram.shaded[m]&&1==this.vennDiagram.shaded[g]:1==this.vennDiagram.shaded[l]&&1==this.vennDiagram.shaded[m]:d?c?1==this.vennDiagram.shaded[v]&&1==this.vennDiagram.shaded[u]&&1==this.vennDiagram.shaded[D]:1==this.vennDiagram.shaded[v]&&1==this.vennDiagram.shaded[o]&&1==this.vennDiagram.shaded[D]:c?1==this.vennDiagram.shaded[o]&&1==this.vennDiagram.shaded[u]&&1==this.vennDiagram.shaded[D]:1==this.vennDiagram.shaded[v]&&1==this.vennDiagram.shaded[u]&&1==this.vennDiagram.shaded[o];case"or":return t?d?c?1==this.vennDiagram.shaded[g]:1==this.vennDiagram.shaded[l]&&1==this.vennDiagram.shaded[m]:c?1==this.vennDiagram.shaded[l]&&1==this.vennDiagram.shaded[m]:1==this.vennDiagram.shaded[g]:d?c?1==this.vennDiagram.shaded[o]&&1==this.vennDiagram.shaded[D]:1==this.vennDiagram.shaded[v]&&1==this.vennDiagram.shaded[u]:c?1==this.vennDiagram.shaded[v]&&1==this.vennDiagram.shaded[u]:1==this.vennDiagram.shaded[o]&&1==this.vennDiagram.shaded[D]}break;case"some":if(h)return null==s?t?!!(this.vennDiagram.marked[l]||this.vennDiagram.marked[g]||this.vennDiagram.marked[m]):!!(this.vennDiagram.marked[o]||this.vennDiagram.marked[v]||this.vennDiagram.marked[u]||this.vennDiagram.marked[D]):t?d?!!this.vennDiagram.marked[m]:!(!this.vennDiagram.marked[l]&&!this.vennDiagram.marked[g]):d?!(!this.vennDiagram.marked[o]&&!this.vennDiagram.marked[u]):!(!this.vennDiagram.marked[v]&&!this.vennDiagram.marked[D]);if(null==r)return t?d?this.checkSelected(this.vennDiagram.marked,m,null):this.checkSelected(this.vennDiagram.marked,l,g):d?this.checkSelected(this.vennDiagram.marked,o,u):this.checkSelected(this.vennDiagram.marked,v,D);switch(i){case"and":return t?d?c?!1:this.checkSelected(this.vennDiagram.marked,m,null):c?this.checkSelected(this.vennDiagram.marked,l,null):this.checkSelected(this.vennDiagram.marked,g,null):d?c?this.checkSelected(this.vennDiagram.marked,o,null):this.checkSelected(this.vennDiagram.marked,u,null):c?this.checkSelected(this.vennDiagram.marked,v,null):this.checkSelected(this.vennDiagram.marked,D,null)}break;case"no":if(h)return null==s?t?!!(this.vennDiagram.shaded[l]&&this.vennDiagram.shaded[g]&&this.vennDiagram.shaded[m]):!!(this.vennDiagram.shaded[o]&&this.vennDiagram.shaded[v]&&this.vennDiagram.shaded[u]&&this.vennDiagram.shaded[D]):t?d?!!this.vennDiagram.shaded[m]:!(!this.vennDiagram.shaded[l]||!this.vennDiagram.shaded[g]):d?!(!this.vennDiagram.shaded[o]||!this.vennDiagram.shaded[u]):!(!this.vennDiagram.shaded[v]||!this.vennDiagram.shaded[D]);if(null==r)return t?d?1==this.vennDiagram.shaded[m]:1==this.vennDiagram.shaded[l]&&1==this.vennDiagram.shaded[g]:d?1==this.vennDiagram.shaded[o]&&1==this.vennDiagram.shaded[u]:1==this.vennDiagram.shaded[v]&&1==this.vennDiagram.shaded[D];switch(i){case"and":return t?d?c?!1:1==this.vennDiagram.shaded[m]:c?1==this.vennDiagram.shaded[l]:1==this.vennDiagram.shaded[g]:d?c?1==this.vennDiagram.shaded[o]:1==this.vennDiagram.shaded[u]:c?1==this.vennDiagram.shaded[v]:1==this.vennDiagram.shaded[D];case"or":return t?d?c?1==this.vennDiagram.shaded[l]&&1==this.vennDiagram.shaded[m]:1==this.vennDiagram.shaded[g]:c?1==this.vennDiagram.shaded[g]:1==this.vennDiagram.shaded[l]&&1==this.vennDiagram.shaded[m]:d?c?1==this.vennDiagram.shaded[v]&&1==this.vennDiagram.shaded[u]:1==this.vennDiagram.shaded[D]&&1==this.vennDiagram.shaded[o]:c?1==this.vennDiagram.shaded[D]&&1==this.vennDiagram.shaded[o]:1==this.vennDiagram.shaded[v]&&1==this.vennDiagram.shaded[u]}}},Problem.prototype.createVenns=function(e){for(var a=e.length,n=0;a>n;n++){var t=[!1,!1,!1,!1,!1,!1,!1],i=[0,0,0,0,0,0,0];n>0&&(t=this.venns[n-1][0].slice(),i=this.venns[n-1][1].slice());var s=e[n].split(" "),r=s[0];s.splice(0,1);var h=s[0],d=!1,c=null,o=null,l=null,m=!1,v=!1,g=!1;if("not"==h&&(h=s[1],d=!0,s.splice(0,1)),s.splice(0,1),"and"==s[0]&&(c="and"),"exist"==s[0])m=!0;else{s.splice(0,1);var o=s[0];"not"==o&&(o=s[1],v=!0,s.splice(0,1)),s.splice(0,1),s.length>0&&("exist"==s[0]?m=!0:(null==c&&(c=s[0]),l=s[1],"not"==l&&(l=s[2],g=!0)))}var u,D,k,p,f,$,w;switch(w=6,1==h?(u=0,f=5,2==o?(D=1,p=3,AABB=7,k=2,$=4,AACC=8):(D=2,k=1,p=4,$=3)):2==h?(u=1,f=4,1==o?(D=0,p=3,k=2,$=5):(D=2,k=0,p=5,$=3)):3==h&&(u=2,f=3,BBCC=7,2==o?(D=1,p=5,k=0,$=4):(D=0,k=1,p=4,$=5)),r){case"all":if(null!=l)switch(c){case"and":d?v?g?(t[D]=!0,t[k]=!0,t[f]=!0):(t[D]=!0,t[f]=!0):g?(t[k]=!0,t[f]=!0):(t[D]=!0,t[k]=!0):v?g?(t[p]=!0,t[$]=!0,t[w]=!0):(t[u]=!0,t[p]=!0,t[w]=!0):g?(t[u]=!0,t[$]=!0,t[w]=!0):(t[u]=!0,t[p]=!0,t[$]=!0);break;case"or":d?v?g?t[f]=!0:(t[k]=!0,t[D]=!0):g?(t[k]=!0,t[D]=!0):t[f]=!0:v?g?(t[u]=!0,t[w]=!0):(t[$]=!0,t[p]=!0):g?(t[$]=!0,t[p]=!0):(t[u]=!0,t[w]=!0)}else d?v?(t[f]=!0,t[D]=!0):(t[k]=!0,t[$]=!0):v?(t[p]=!0,t[w]=!0):(t[u]=!0,t[$]=!0);break;case"some":var b=this.maxValue(i)+1;if(m)null==o?(i[u]=!0,i[p]=!0,i[$]=!0,i[w]=!0):(i[p]=!0,i[w]=!0);else if(null!=l)switch(c){case"and":d?v?g||(i[k]=b):g?i[D]=b:i[f]=b:v?g?i[u]=b:i[$]=b:g?i[p]=b:i[w]=b;break;case"or":d?v?g?(i[D]=b,i[k]=b):i[f]=b:g?i[f]=b:(i[D]=b,i[k]=b):v?g?(i[p]=b,i[$]=b):(i[w]=b,i[u]=b):g?(i[w]=b,i[u]=b):(i[p]=b,i[$]=b)}else d?v?i[k]=b:(i[D]=b,i[f]=b):v?(i[u]=b,i[$]=b):(i[p]=b,i[w]=b);break;case"no":if(m)null==o?(t[u]=!0,t[p]=!0,t[$]=!0,t[w]=!0):(t[p]=!0,t[w]=!0);else if(null!=l)switch(c){case"and":if(d)if(v){if(g)return!0;t[k]=!0}else g?t[D]=!0:t[f]=!0;else v?g?t[u]=!0:t[$]=!0:g?t[p]=!0:t[w]=!0;break;case"or":d?v?g?(t[D]=!0,t[k]=!0):t[f]=!0:g?t[f]=!0:(t[D]=!0,t[k]=!0):v?g?(t[p]=!0,t[$]=!0):(t[w]=!0,t[u]=!0):g?(t[w]=!0,t[u]=!0):(t[p]=!0,t[$]=!0)}else d?v?t[k]=!0:(t[D]=!0,t[f]=!0):v?(t[$]=!0,t[u]=!0):(t[p]=!0,t[w]=!0)}for(var C=0;C<i.length;C++)1==t[C]&&(i[C]=0);var P=[];P.push(t),P.push(i),this.venns.push(P)}};
